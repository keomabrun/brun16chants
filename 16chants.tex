\documentclass{sig-alternate}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{color}
\usepackage{xspace}
\usepackage{url}
 \usepackage[utf8]{inputenc}

 % lorem
\newcommand{\lorem}               {\textcolor{green}{Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.}}

% reviews
\newcommand{\thomas}[1]             {\textcolor{blue}{[Thomas] #1}}
\newcommand{\javier}[1]             {\textcolor{purple}{[Javier] #1}}
\newcommand{\keoma}[1]              {\textcolor{cyan}{[Keoma] #1}}
\newcommand{\remy}[1]               {\textcolor{yellow}{[Remy] #1}}
\newcommand{\jonathan}[1]           {\textcolor{pink}{[Jonathan] #1}}

% shortcuts
\newcommand{\name}                  {PEACH\xspace}
\newcommand{\smip}                  {SmartMesh~IP\xspace}

\graphicspath{{figures/}}

\begin{document}
\title{Feedbacks from a real-world low-power wireless sensor network deployment}

\numberofauthors{5}
\author{
  \alignauthor Brun-Laguna Keoma\\
    \affaddr{Inria, EVA team, Paris, France}\\
    \email{keoma.brun@inria.fr}
  \alignauthor Vilajosana Javier\\
    \affaddr{Universitat Oberta de Catalunya, Barcelona, Catalonia, Spain}\\
    \email{xvilajosana@uoc.edu}
  \alignauthor Léone Rémy \\
    \affaddr{Inria, EVA team, Paris, France}\\
    \email{remy.leone@inria.fr}
  \and
  \alignauthor Muñoz Jonathan\\
    \affaddr{Inria, EVA team, Paris, France}\\
    \affaddr{Gridbee, France}\\
    \email{jonathan.munoz@inria.fr}
  \alignauthor Watteyne Thomas \\
    \affaddr{Inria, EVA team, Paris, France}\\
    \email{thomas.watteyne@inria.fr}
}

\maketitle

\begin{abstract}
\lorem
\end{abstract}

\keoma{TODO:replace all images with .eps}

%==============================================================================
\section{Introduction}
\label{sec:intro}

% the PEACH project

Low temperatures have a very harmful impact on peach production as in 2013, 85\% of the production in the Mendoza region (western Argentina) was lost because of frost.
In April 2016, three research teams from different countries joined to start the deployment of a frost events prediction system~\cite{watteyne16peach}.
The goal of this project is to be able to precisely predict frost events and consequently reduce the impact of frost on peach production.
Frost detection systems already exist but few are actually able to propose prediction.

% the architecture

Due to the heavy machinery used to exploit the peach production, using cables is not conceivable.
The deployed solution is composed of a low-power wireless network and a back-end system to retrieve and visualize the data.
The network is formed by \smip devices from the Linear Technology company and is in charge of measuring the orchard environment, gather the data into a gateway and pass it to the back-end system.
The system collects both sensor values and network statistics.
The back-end system stores and backups the data and provide a visual interface and an API to access the data minutes after it was measured in Argentina.

% the deployment

The low-power wireless network is composed of 18 nodes uniformly distributed between the peach trees and 3 nodes to connect the orchards node and the gateway~\ref{fig:map}.
The covered area is an orchard with 204 trees on a 50*100m surface.
Each network mote is placed inside a water-tight box that is fixed on a 4m pole~\ref{fig:orchard}.
At the time of writing, the project is on its first stage.
During this stage, the goal is to verify that the network fulfill its requirements and that all the sensor values and statistics are correctly collected.
The location and environment of the current temperature sensors are not adequate, consequently, we do not exploit that information in this paper.
During the second stage, we will introduce additional sensors such as air temperature at different high, air relative humidity, soil moisture and soil temperature.

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{orchard}
    \caption{The wireless motes deployed inside the orchard in Mendoza (Argentina)}
    \label{fig:orchard}
\end{figure}

\begin{table}
\begin{center}
    \begin{tabular}{ | c | c | c | c | c |}
         \hline
           & 1 & 2 & 3 & 4\\
         \hline
         1 & 30-60-ef* & 3f-f8-20 & 58-32-36* & 60-03-82 \\
         2 & 3f-fe-87  & 3f-fe-88 & 60-06-0f  & 60-08-d5 \\
         3 & 60-05-5f  & 60-06-27 & 60-05-69  & 60-01-f8 \\
         4 & 60-06-ec  & 60-05-ab & 60-02-4b  & 60-02-1b \\
         5 & 38-0f-66  & 60-05-78 &           &          \\
         \hline
    \end{tabular}
    \caption{The MAC addresses of the motes inside the orchard (last 3 bytes). Refer to numbers displayed on the map. (*) DC9018 node with external antenna.}
\end{center}
\end{table}

\begin{figure*}
    \centering
    \includegraphics[width=\textwidth]{map_annotated}
    \caption{A map of the sensor deployed in the orchard near Mendoza (Argentina)}
    \label{fig:map}
\end{figure*}

% the hardware

We use four types of \smip devices to form the low-power wireless network.
The DC9018 with external antenna and the DC9003 with chip antenna are deployed inside the orchard.
Longe-range modes \keoma{@thomas: could you replace with exact name} are deployed outside the orchards to connect the network with the DC2274 device that is the gateway.

% the technology

The \smip motes are based on the IEEE 802.15.4e standard~\cite{std_ieee802154e} that includes a channel hopping mechanism to reduce the impact of multipath fading.
Channel hopping exploit the frequency diversity to reduce the probability of interferences and improve link reliability.
This mechanism show good results in the Wireless Sensor Network (WSN) context~\cite{watteyne2010mitigating, watteyne2009reliability} and allows to achieve high reliability while saving energy.

% the data

Each mote produce a temperature value every 30 seconds and network statistics, called ``health-reports'', every 5~minutes.
In 3~months, we gathered more than 2M~temperature value, and more than 180K~network statistics.
The health reports produced by any mote contain information about the mote itself and also about its neighbors.
%65184 HR_DEVICE, 63245 HR_DISCOVERED and 50285 HR_NEIGHBORS


% the goal of this paper

The goal of this paper is to present the first feedbacks we have from the 3-month-old project and the lessons we learned from deploying WSN in real environment.
This paper makes the following contributions:
\begin{itemize}
    \item{We analyse the link asymmetry and show that a link can be consider symmetrical in certain conditions}
    \item{}
\end{itemize}


% paper organisation

The remainder of this paper is organized as follows.
Section~\ref{sec:collected} gives an in-depth description of the data we collect and their quantity.
Sections~\ref{sec:symmetry} to \ref{sec:charge} describes the different analysis we performed on RSSI, PDR, distance and charge.
Finally, Section~\ref{sec:conclusion} concludes this paper and discusses further improvements.

%==============================================================================
\section{Collected Data}
\label{sec:collected}

% health report description

Each device in the network produce both sensor data and network statistics.
Network statistics can be separated in \textbf{Events} and \textbf{Health Reports} messages.
The Events messages are non periodic information triggered for instance when a node join the network or when a link (layer 2) is created/deleted.
The Health Report (HR) message are sent periodically and provide counters and statistics to assess the overall network health.
There are three types of HR:
\begin{itemize}
  \item HR\_DEVICE give information about the mote itself
  \item HR\_NEIGHBORS give information about the mote active neighbors
  \item HR\_DISCOVERED give information about the mote potential neighbors
\end{itemize}
Each device sends one type of Health Report every 5~min making the complete set of Health Report generated every 15~min.

%------------------------------------------------------------------------------
\subsection{HR\_DEVICE}

\keoma{should we actually put all the technical details here ?}
An HR\_DEVICE message contains the following fields:\\
\begin{tabular}{l|p{6cm}}
    field name      & description\\
    \hline
    charge          & node charge in mC\\
    queueOcc        & mean and max queue occupancy.\\
    temperature     & built-in temperature sensor value in C\\
    batteryVoltage  & node battery voltage in mV\\
    numTxOk         & number of packets sent from NET to MAC\\
    numTxFail       & number of packets not sent due to congestion or failure to allocate a packet\\
    numRxOk         & number of packets received\\
    numRxLost       & number of packets lost (discarded by NET layer due to misc errors)\\
    numMacDropped   & number of packets dropped by MAC (due to retry count or age or no route)\\
    numTxBad        & transmit failure counter for bad link\\
    badLinkFrameId  & frame id of link with the worst performance over the last health report interval\\
    badLinkSlot     & slot of link with the worst performance over the last health report interval\\
    badLinkOffset   & offset of link with the worst performance over the last health report interval\\
\end{tabular}

% HR_DISCOVERED

\lorem

% HR_NEIGHBORS

\lorem

% dataset

Over a period of 4 months, we collected a total of:
\begin{itemize}
    \item 140897 HR\_NEIGHBORS messages\\
    \item 87737 HR\_DISCOVERED messages\\
    \item 132758 HR\_DEVICE messages\\
\end{itemize}

%==============================================================================
\section{Link Symmetry}
\label{sec:symmetry}


% RSSI expectations

The Received Signal Strength Indication (RSSI) values can be retrieved from both active neighbors and discovered neighbors Health Reports, thus every 15~min for each pair of device.
Those RSSI values are averaged values over the 16 channels defined in the IEEE 802.15.4 standard~\cite{std_ieee802154_2011}.
In the rest of that paper we will use RSSI to denote the average RSSI over the 16 channels.

% environment

The peach orchard is located in a rural area that is not exposed to high traffic on the ISM band so we do not expect important external interferences.
Heavy machinery is used inside the orchard by farmers approximately every 20 days and during a period of one to two hours.
Those movements could create internal interferences such as multipath fading.

% symmetry analysis

A common assumption is to assume that a layer 2 link between two identical wireless nodes is asymmetrical.
We looked at the links statistics between the 18th of June and the 4th of July (16 days) and analysed the difference between the RSSI values.
The sample contains 411132 HR\_NEIGHBORS messages and concern 14 nodes with same hardware (DC9003).
During that period, 21 different bidirectional links are active with at least 50 transmissions.
For each of those links, we compute the RSSI difference for the two directions of the link (i.e from A to B and from B to A) and present the results in Fig.~\ref{fig:tab_symmetry}).
The very low RSSI difference shows that the links are very symmetrical.
Note that the RSSI is an average over the different channels.

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{sym_plot}
    \caption{The different active links between 2016-06-18 and 2016-06-25}
    \label{fig:tab_symmetry}
\end{figure}


%------------------------------------------------------------------------------
\section{Link Stability}
\label{sec:link_stability}

\lorem

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{pister_hack}
    \caption{The famous Pister-Hack model here}
    \label{fig:pister_hack}
\end{figure}

%------------------------------------------------------------------------------
\subsection{RSSI Threshold}

% sample presentation

Due to the inherent physical unreliability of the radio medium, it is impossible to know if a future transmission will be successful or not.
The Packet Delivery Ratio (PDR) is the proportion of successful transmissions over the total number of transmissions.
Over a period of 4 months, 140897 HR\_NEIGHBORS messages were collected.
Nodes maintain a list of potential neighbors with which they do not communicate with.
We removed the portion of neighbors with no transmission (237252 messages) and kept only the DC9003 motes, resulting into a total of 125103 messages (approx. 27\%).

% Waterfall

In Fig.\ref{fig:waterfall}, we show the so-called \textit{waterfall plot}, displaying the RSSI values against PDR values over the 4-months period.
A clear threshold appears when the RSSI values go below -85dBm.
For RSSI values above that threshold, the PDR drastically decreases implying retransmission.
When the RSSI values are below that threshold, PDR values remain near 100\%, inducing successful transmissions.

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{waterfall}
    \caption{The PDR/RSSI waterfall. After the -85dBm RSSI threshold, PDR values significantly drop.}
    \label{fig:waterfall}
\end{figure}

%==============================================================================
\section{Reliability}
\label{sec:reliability}

% reliability expectation

Channel Hopping greatly improves the PDR \cite{watteyne2010mitigating}.
Fig.\ref{fig:stats_reliability} presents the PDR statistics for each mote over the same sample as presented in the previous section.
The global mean PDR over the entire sample is 0.983\% with a standard deviation of 0.045.
In other words, for 1000 packets sent, 983 are received in average.

\begin{figure}
    \centering
    \includegraphics[width=0.9\columnwidth]{stats_reliability}
    \caption{This table shows the PDR statistics for each mote over a four-month period.}
    \label{fig:stats_reliability}
\end{figure}

%==============================================================================
\section{Network Stability}
\label{sec:net_stability}

% description

The nodes in the network form a Destination Oriented Direct Acyclic Graph (DODAG) oriented toward the gateway (i.e the DAG root).
Each node maintains a list of neighbors, with which they communicate or not, and dynamically change their routes depending on link quality. \keoma{@thomas:is it true ? or they use other metrics ?}
When reliability is high the network topology stay stable and the nodes use the same neighbors.
When the reliability decreases, nodes select other neighbors, making the network graph to change.
Instability in the network increases the signaling traffic to reconstruct the routes and introduce more bandwidth and energy consumption.

%

To study the network stability we use the \textit{path\_delete} and \textit{path\_create} event messages.
Those messages are sent every time a path with a neighbor is deleted or created responsively.
Here a path denotes a layer 4 association between two nodes.
Fig.\ref{fig:net_churn} shows the number of events message per hour as well as the total number of links per hour over a two-weeks period.
We can see that the number of links stay close to 35 for the entire period of time.
The number of path\_create and path\_delete is also kept low.

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{net_churn}
    \caption{Network churn here}
    \label{fig:net_churn}
\end{figure}

%==============================================================================
\section{Charge}
\label{sec:charge}

% description

Each device is powered by a pair of AA battery (Energizer L-91) with a charge of approximately 2200mAh.
The charge is measured by a build in sensor inside the \smip board. \keoma{@thomas: could you give me more details}

%

Fig.\ref{fig:stats_charge} shows the device charge statistics over a 4-month period.
Every node is crucial in this application as it is connected to multiple sensors and represents one part of the orchard that could be prone to frost.
We thus consider the network lifetime as the time when the first node runs out of battery.
The node with the minimal amount of day left is node b0-00-cc, that is one of the long-range node that is use to link up the orchard motes to the network gateway.
It is logical that this node spend more energy than the others as all the traffic passes through it~\ref{fig:map}.
Node b0-00-cc as thus a lifetime of 1218 days, that is above 3 years lifetime.

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{stats_charge}
    \caption{The charge statistics over a 4-month period.}
    \label{fig:stats_charge}
\end{figure}


%==============================================================================
\section{Conclusion}
\label{sec:conclusion}

% conclusion

\lorem

%==============================================================================

\bibliographystyle{abbrv}
\bibliography{16chants}

\end{document}

%
